# 品質管理図
    品質管理図はあるプロセスが統計的管理下にあるかどうかを観測者が監視する場合のツールで、
    これらは変動を可視化し、問題が発生した場合にそれを見つけて修正、予想結果の範囲の予測
    特別な原因または一般的な原因からのプロセス変動のパターンを分析するのに役立つ。
    
    品質管理図は６σや管理フェーズのDMAICで使用され、プロセス改善のための７つの基本的な
    品質ツールの１つになる。

# パレート図
    パレート図とは、値が降順（大きい順）になるようにプロットした棒グラフと、
    その値を累積で表示した折れ線グラフを組み合わせたグラフ

## パレートの法則 <1>
    パレートの法則は、イタリアの経済学者のパレートさんが発見した法則です。
    経済において、全体の大部分はそれを構成する一部の要素が生み出しているというもの
    ・税金納付額の80%は、国民のうち20%の富裕層が負担している。
    ・故障の原因の80%は、全ての部品のうち20%に起因する。
    ・売り上げの80%は、全顧客のうち20%が占めている
    

    パレート図の目的は、複数の要因の中から重要なものを抽出することです。
    例えば、欠陥を引きおこす主要原因の把握等に優れています。
    品質管理以外では、在庫管理やABC分析においてもしばしば用いられている

    パレート図を利用することで、各項目が全体でどれくらいの割合を示している
    のかが一目で分かるようになり、重要性や改善を行う優先度の判断ができるよう
    になります。
    件数の多いものから優先的に対策を行うことで、効率的に改善を進めることができます。
    
    パレート図では、どの要素を対策すれば、全体の課題のうち何割を改善できるかを、
    視覚的にわかりやすく理解できるのが特徴です。

## パレート図　<2>
    問題点の把握と重点項目が分かる
    棒グラフは、左から順に多いものから並べていきます。そのため、どの項目が多いのか、
    どの項目が少ないのか把握していくことができます。
    
    棒グラフは累積で示していくため棒グラフ上位の要素が、全体でどれくらいの割合を
    占めているのかが一目で把握可能です。
 
    一目で見て、上位2割を大切にしていけばよいと戦略を立てる一つの指標にはなりますが、
    上位2割以外には、上位2割と関係が深かったり、改善することで上位になることもある
    かもしれません。
    このように、上位2割だけでなくトータルで問題点や重点項目を把握可能です。

    改善前のパレート図と改善後のパレート図を見比べてみることで、施策が合っていたのか、
    施策によってどのように変わったのか？も把握可能です。次期の戦略策定にも役立つ

### パレート図使用方法
    パレート図が作成してあると過程する。
    このパレート図は全体の損失金額を8割減らしたいと考える。
    その場合linePlotは累積比率であるから、8割、つまり80%の部分を見る
    (縦線を引くとわかりやすい)
    後はこの縦線より左の項目に対処するだけでよい。
    つまり縦線よりも左側の項目がなくなれば、損失は８割減となるという事。

    原因の20%が結果の80%を作っているという事。
    つまり問題とする事の約80%が原因の20%の結果であるという事。
    裏を返せば、上位20%の原因を潰せば問題の80%が解決するという事。

### パレートが役に立たない場合
    カテゴリデータを使用すると、サンプルはグループに分割され、
    応答の順序が定義される場合があります。
    たとえば、「まったくそう思わない」から「非常にそう思う」までのスケールで
    意見を述べるように求められる調査では、あなたの回答は分類的です。
    パレート図は、変数に定義された順序ではなく頻度カウントでデータを順序付けるため、
    ここでは役に立たない可能性があります。

### パレートのデメリットと悪手
    簡単に理解できるパレートの法則は、問題解決者によって、
    重要な少数の要因を些細な多くの要因から分離するための強力な根本原因分析ツール
    として長い間使用されてきました。
    ただし、パレート図の明らかな単純さは、多くのシックスシグマプロジェクト
    を元に戻すことであることが証明されています。

### パレートの用途
    ■ 発生件数や発生金額での分類としては、
    ・不良発生件数や不良発生金額の分析
    ・クレーム件数やクレーム金額の分析
    ・設備の故障発生件数や故障発生金額の分析
    ・製品別の在庫個数や在庫金額の分析

    ■ 原因別での分類としては、
    ・不良発生原因別の分析
    ・クレーム発生原因別の分析
    ・故障発生原因別の分析
    ・在庫発生原因別の分析
    
### ABC分析
    全体に占める度数の割合が大きい項目をA、中程度の項目をB、少ない項目はCと分類して、
    全体に占める割合の大きさごとに分析を行っていく分析手法をABC分析といいます。
    この分析は企業戦略における商品開発や商品購入層の分布分析、
    製品の不良品発生率の管理などにも活用されています。

## 管理図の基本
    管理図は分布の平均値を中心線(CL)とし、その上下に標準偏差σの3倍(3σ)だけ離れた
    管理限界線を引き、経時的に得られる推定値の平均をPlotし、もし限界の外に出た場合
    に対処を行うという事。

    管理図に使うデータは、測定値の平均\={x}であり、\={x}の母集団を考えて
    その母平均μと標準偏差σを得られたデータから計算した値で代用
    
    平均値がμで標準偏差σは、１つの母集団からランダム取得したnのサンプルの平均値
    \={x}の分布は以下のような性質を持つ

> 1. \={x}の分布の平均値μ\={x}はμである。誤差はあるものの、母集団の平均とほぼ同じ
> 2. \={x}の分布の標準偏差σ\={x}は\begin{displaymath}\frac{σ}\sqrt{n}\end{displaymath}となる
> 3. \={x}の分布は正規分布

    μの代用には\={x}の平均\~{x}を使う。σは範囲の平均値\={R}から推定する
    この為に\={R}を係数で割ると\={x}の分布の標準偏差が求められ、さらに\={x}
    の分布の標準偏差σを求めるために、データ数nの平方根で割る
> \begin{displaymath}
σの推定値 = \frac{R}d\sqrt{n}
\end{displaymath}

    したがって
    \={x}を中心線(CL)
    \={x}+\left( \frac{3\={R}}{d\sqrt{n}} \right)を上方管理限界(UCL)
    \={x}-\left( \frac{3\={R}}{d\sqrt{n}} \right)を下方管理限界(LCL)
    として\={x}管理図が作成される

    \begin{displaymath}σの推定値 = \frac{3\={R}}d\sqrt{n}\end{displaymath}
    は、nが決まれば決まるので、この値を各nに対して計算した表がA_{2}という記号で示す

    \={x}管理図
    UCL = \={x}+A_{2}\={R}
    LCL = \={x}-A_{2}\={R}

    R管理図
    UCL = D_{4}\={R}
    LCL = D_{3}\={R}

## 管理図ツリー
    使用する適切な管理図は、データのタイプ(測定)、欠落の数、およびサンプルサイズ
    によって決まる。
    このディレクトリ直下のQualityControl.PNGに決定木がありそれを参照して
    使用できる管理図の条件を示している。

## 管理限界

    管理限界は、品質管理図の中心線（つまり平均）の上下にプロットされた線であり、
    信号（つまり管理限界を超えるポイント）を識別し、プロセスが統計的管理下にあるか
    どうかを判断するためのしきい値として機能します。これらは、サンプルサイズに応じて
    変化する定数を含む、各タイプの管理図に固有の式によって定義されます。
    このような定数を次の表に示します。

# 管理図
## SampleSize
    標本の数(データ数)これはColumnsに対応する。
    Columnsの数が５であればn=5(m=5)の管理限界定数のA2...を参照(n=5, A2)する

## 管理図作成手順
    １．データ用意
    ２．測定値の和を求める
    ３．平均値を求める
        index(行)ごとの平均\={x}を計算する
    ４．範囲を計算する
        index(行)ごとの最大値、最小値(max-min)を計算し、範囲Rとする
    ５．平均値と範囲をPlotする
    ６．中心線(CL)を計算
        １．index毎の\={x}のcolumn平均を算出し、それを中心線(CL)とする
        　　\={x}/n = \~{x}
        ２．範囲Rのcolumn平均を求める
            R/n = \={R}
    ７．管理限界線を計算する
        1. column数に対して管理限界係数表(imageFolder)からn数に相当するA_{2}
           を得る。
        2. UCL = \~{x} + A_{2}\={R}
            (例)　18 + 0.577 * 0.25 = UCL
        3. LCL = \~{x} - A_{2}\={R}
        
        ４．R
            nに相当するD_{4}、D_{3}を得る
            UCL = D_{4}\={R}
            (例) 2.114 * 0.25 = UCL
            LCL = D_{3}\={R}
                0 * 0.25 = 0

    (*1)RのLCL係数D_{4}D_{3}はn>6以下の時D_{3}はほぼ0に近いので考慮する必要性は下がる

# チャートの種類と説明

## X-Chart / mR-Chart
    xチャートとmRチャート
    xチャート（個別チャートとも呼ばれます）とmRチャートは、特定の時間に取得された
    個々のサンプルに基づいて、プロセスの平均と変動を監視するために使用されます。
    mRチャートをxチャートと一緒に使用するには、サンプルサイズnが1に等しくなければ
    ならない。

    ・xチャートでは、y軸は平均と管理限界を示し、x軸はサンプル単位を示します。
    ・mRチャートでは、y軸は移動範囲の総平均と管理限界を示し、
    　x軸はサンプル単位を示します。

## X-bar Chart / R Chart
    xバーとRチャートは、特定の時間に採取されたサンプルに基づいて、
    プロセスの平均と変動を監視するために使用されます。
    Rチャートをxバーチャートと一緒に使用するには、
    サンプルサイズnが1より大きく11未満である必要があります。

    ・xバーチャートでは、y軸は総平均と管理限界を示し、x軸はサンプルグループを示す。
    ・Rチャートでは、y軸は範囲の総平均と管理限界を示し、x軸はサンプルグループを示す。

## x-bar chart / s chart
    xバーとsチャートは、特定の時間に取得されたサンプルに基づいてプロセスの
    平均と変動を監視するために使用されます。
    sチャートをxバーチャートと一緒に使用するには、サンプルサイズnが10単位より大きく
    なければならない。
    x棒グラフでは、y軸は総平均と管理限界を示し、x軸はサンプルグループを示す。
    sチャートでは、y軸は標準偏差の総平均と管理限界を示し、x軸はサンプルグループを示す。

# 離散データの管理図
## cチャート
    cチャートは、サイズnの固定サンプルの欠陥の総数を監視するために使用されます。
    y軸はサンプルごとの不適合の数を示し、x軸はサンプルグループを示します。

    (例)
    欠点を発生する可能性のあるひろがり（空間的，時間的）が一定の製品中の欠点数，
    たとえば一定の大きさの鉄板のきずの数，一定の大きさの織物の織むら，
    一定の長さの電線の表面きずなどで工程を管理する場合に用いる。
    品物１個中の欠点数が少ない場合には，一定個数の品物の中の欠点数を用いてもよい、
    一定期間中に発生した故障件数，事故件数などを管理する場合にも応用できる。
    
    一定の大きさのサンプルを少くとも約20～25群とり，各群中の欠点数Ｃを調べる。
    サンプルの大きさは，だいたい平均としてサンプル中１～５個位の欠点数
    が含まれるようにする。

## uチャート
    uチャートは、サイズnのさまざまなサンプルのユニットあたりの欠陥の総数を監視
    するために使用。ユニットに複数の欠陥がある可能性があることを前提としています。
    y軸は単一ユニットあたりの欠陥数を示し、x軸はサンプルグループを示します。

    製品の欠点を発生する可能性のあるひろがりが，
    いろいろ変化する場合に製品の一定単位を定めて，その一単位あたりの欠点数，
    たとえば一定面積あたりの織物の織むら，一定長さのあたりのエナメル線
    のピンホールなどで工程を管理する場合に用いる。

    少くとも約20～25群のサンプルをとり，サンプルの大きさ（長さ，面積，時間など）と，
    サンプル中の欠点数をしらべる。
    サンプルの大きさは，だいたい平均としてサンプル中に１～５個の欠点数が含まれる
    ようにする。

    各群ごとの単位あたりの欠点数uを求める。
    これを一般式で表わすと
    u＝c/n　ここに
    c：サンプル中の欠点数
    n :サンプルの大きさ
    たとえば1500 m のエナメル線を検査し，ピンホールが５個あったとする。
    1000 mを単位とすれば，1500 m は1.5単位であるので単位あたりの欠点数は次
    のように計算される。
    n＝1500/1000=15　u＝5/15=3.33
    備考:　500 m を単位とすれば，単位あたりの欠点数はつぎのようになる。
    n=1500/500=3.0
    u=5/3.0=1.67

    表装紙のプリントエ程を管理するため，プリント不良個所の数をしらべる。
    サンプルの幅は一定であるが長さが種々変わるので，
    単位長さあたりのプリント不良個所の数を用いる。

## pチャート
    pチャートは、サイズnのさまざまなサンプルの不適合ユニットの割合を監視するため
    に使用。
    これは、各ユニットに2つの可能性（つまり、欠陥があるかどうか）しかない二項分布
    に基づいています。
    y軸は不適合ユニットの割合を示し、x軸はサンプルグループを示します。

    だいたい平均としてサンプル中に１～５個位の不良個数が含まれるような大きさのサンプル
    を少くとも約20～25群とり測定検査して不良個数をしらべる。

    

## np-チャート
    npチャートは、サイズnの固定サンプルの不適合ユニットの数を監視するために
    使用。y軸は不適合ユニットの総数を示し、x軸はサンプルグループを示します。

    工程を不良個数によって管理する場合で，サンプルの大きさが一定の場合に用いる。
    またこの場合，良品個数とか，２級品個数などでも適用できる。
    pはロットの不良率，nは検査台数です、因ってpnは不良の個数です。

    サンプルの大きさが一定でない場合はｐ管理図を用いる。

    データのとり方はだいたい平均としてサンプル中に１～５個位の不良個数が含まれる
    ような大きさのサンプルを少くとも約20～25群をとり測定検査して不良個数pnを調べる。
    サンプルの大きさの見当をつけるには，不良率ｐを予想して，
    サンプル中に１～５個の不良が含まれるようにする。

    ある部品のショットブラストエ程で　部品120個ずつ表面処理加工を行っているが，
    この工程を管理するために外観検査による120個ずつの表面仕上り不良の数をしらべた。


### 参照URL

・[Quality Control Charts with Python](https://towardsdatascience.com/quality-control-charts-guide-for-python-9bb1c859c051)

・[GitHub-QCC](https://github.com/rsalaza4/Python-for-Industrial-Engineering/tree/master/Quality%20Control%20Charts)

・[d2N表](https://support.minitab.com/ja-jp/minitab/18/help-and-how-to/quality-and-process-improvement/control-charts/how-to/variables-charts-for-individuals/i-mr-chart/methods-and-formulas/methods-and-formulas-for-individuals-chart/)

・[管理図とは](https://takuminotie.com/blog/quality/%E7%AE%A1%E7%90%86%E5%9B%B3/)

・[パレート図](https://wa3.i-3-i.info/word15629.html)

・[パレートの用途](https://www.jmp.com/en_nl/statistics-knowledge-portal/exploratory-data-analysis/pareto-chart.html)

・[総務省統計局：パレート図](https://www.stat.go.jp/naruhodo/9_graph/jyokyu/pareto.html)
